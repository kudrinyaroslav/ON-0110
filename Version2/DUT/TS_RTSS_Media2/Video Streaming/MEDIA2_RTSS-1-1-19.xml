<?xml version="1.0" encoding="utf-8"?>
<TestSuit Name="Device Managment" Version="0.1">
  <Parameters>
    <TimeOut>100000</TimeOut>
    <Name>MEDIA2 STREAMING – H.264 (RTP-Unicast/RTSP/WebSockets)</Name>
    <Description>
	  Use service/1 user name and password on Discovery tab
		  
		  
      Media service must be: http://localhost:2780/MediaService.asmx
    </Description>
  </Parameters>

  <!--positive-->
  
  <!-- Annex 6 -->
  
  <Test ID = "TC.MEDIA2_RTSS-1-1-19.101" ONVIFTestID="MEDIA2_RTSS-1-1-1" Enabled="true">
    <TestName>MEDIA2 STREAMING – H.264 (RTP-Unicast/RTSP/WebSockets)</TestName>
    <Name>Correct websocket address (ws) in capabailities</Name>
    <Description>
      ip.addr == 174.129.224.73
    </Description>
    <ExpectedResult>
      <ONVIFTestResult>PASSED</ONVIFTestResult>
      <TestSummary>

      </TestSummary>
    </ExpectedResult>
    <Step id="2">
      <Command>Media210.GetServiceCapabilities</Command>
      <Response>Normal</Response>
      <RequestParameters>
      </RequestParameters>
      <ResponseParameters>
        <Capabilities2 SnapshotUri="true" Rotation="true" VideoSourceMode="true" OSD="true" xmlns:tcr="http://www.onvif.org/ver20/media/wsdl">
          <tcr:ProfileCapabilities MaximumNumberOfProfiles="3" ConfigurationsSupported="VideoSource VideoEncoder"></tcr:ProfileCapabilities>
          <tcr:StreamingCapabilities RTSPStreaming="true" RTPMulticast="true" RTP_RTSP_TCP="true" NonAggregateControl="true" RTSPWebSocketUri="ws://echo.websocket.org"></tcr:StreamingCapabilities>
        </Capabilities2>
      </ResponseParameters>
    </Step>
    <!--<Step id="2">
      <Command>Media210.GetServiceCapabilities</Command>
      <Response>Normal</Response>
      <RequestParameters>
      </RequestParameters>
      <ResponseParameters>
        <Capabilities2 SnapshotUri="true" Rotation="true" VideoSourceMode="true" OSD="true" xmlns:tcr="http://www.onvif.org/ver20/media/wsdl">
          <tcr:ProfileCapabilities MaximumNumberOfProfiles="3" ConfigurationsSupported="VideoSource VideoEncoder"></tcr:ProfileCapabilities>
          <tcr:StreamingCapabilities RTSPStreaming="true" RTPMulticast="true" RTP_RTSP_TCP="true" NonAggregateControl="true" RTSPWebSocketUri="ws://websocketstest.com"></tcr:StreamingCapabilities>
        </Capabilities2>
      </ResponseParameters>
    </Step>-->
    <Step id="1">
      <Command>Device10.GetServices</Command>
      <Response>Normal</Response>
      <RequestParameters>
        <IncludeCapability>False</IncludeCapability>
      </RequestParameters>
      <ResponseParameters special="1">
        <ArrayOfService xmlns:tds="http://www.onvif.org/ver10/device/wsdl" xmlns:tt="http://www.onvif.org/ver10/schema">
          <Service>
            <tds:Namespace>http://www.onvif.org/ver10/device/wsdl</tds:Namespace>
            <tds:XAddr>http://localhost/onvif/ServiceDevice10/DeviceServiceFake.asmx </tds:XAddr>
            <tds:Version>
              <tt:Major>2</tt:Major>
              <tt:Minor>1</tt:Minor>
            </tds:Version>
          </Service>
          <Service>
            <tds:Namespace>http://www.onvif.org/ver10/events/wsdl</tds:Namespace>
            <tds:XAddr>http://localhost/onvif/ServiceEvents10/EventService.asmx</tds:XAddr>
            <tds:Version>
              <tt:Major>2</tt:Major>
              <tt:Minor>1</tt:Minor>
            </tds:Version>
          </Service>
          <Service>
            <tds:Namespace>http://www.onvif.org/ver20/media/wsdl</tds:Namespace>
            <tds:XAddr>http://localhost/onvif/ServiceMedia20/Media2Service.asmx</tds:XAddr>
            <tds:Version>
              <tt:Major>2</tt:Major>
              <tt:Minor>1</tt:Minor>
            </tds:Version>
          </Service>
        </ArrayOfService>
      </ResponseParameters>
    </Step>

    <Step id="2">
      <Command>Media210.GetProfiles</Command>
      <Response>Normal</Response>
      <RequestParameters>
	    <Type>VideoSource</Type>
        <Type>VideoEncoder</Type>
      </RequestParameters>
      <ResponseParameters>
        <ArrayOfMediaProfile>
          <MediaProfile token="media_profile1">
            <Name xmlns="http://www.onvif.org/ver20/media/wsdl">media2_profile1</Name>
            <Configurations xmlns="http://www.onvif.org/ver20/media/wsdl" xmlns:tt="http://www.onvif.org/ver10/schema">
              <VideoSource token="VSC1">
                <tt:Name>VideoSourceConf1</tt:Name>
                <tt:UseCount>1</tt:UseCount>
                <tt:SourceToken>VS1</tt:SourceToken>
                <tt:Bounds height="1080" width="1920" y="1" x="1">
                </tt:Bounds>
              </VideoSource>
              <VideoEncoder token="VEC1">
                <tt:Name>VideoEncConf1</tt:Name>
                <tt:UseCount>1</tt:UseCount>
                <tt:Encoding>H264</tt:Encoding>
                <tt:Resolution>
                  <tt:Width>401</tt:Width>
                  <tt:Height>801</tt:Height>
                </tt:Resolution>
                <!--<tt:RateControl>
                  <tt:FrameRateLimit>1</tt:FrameRateLimit>
                  -->
                <!--<tt:EncodingInterval>0</tt:EncodingInterval>-->
                <!--
                  <tt:BitrateLimit>2048</tt:BitrateLimit>
                </tt:RateControl>-->
                <!--<tt:H264>
                <tt:GovLength>32</tt:GovLength>
                <tt:H264Profile>Baseline</tt:H264Profile>
              </tt:H264>-->
                <tt:Multicast>
                  <tt:Address>
                    <tt:Type>IPv4</tt:Type>
                    <tt:IPv4Address>0.0.0.0</tt:IPv4Address>
                  </tt:Address>
                  <tt:Port>0</tt:Port>
                  <tt:TTL>3</tt:TTL>
                  <tt:AutoStart>false</tt:AutoStart>
                </tt:Multicast>
                <tt:Quality>7</tt:Quality>
                <tt:SessionTimeout>PT0S</tt:SessionTimeout>
              </VideoEncoder>
            </Configurations>
          </MediaProfile>
        </ArrayOfMediaProfile>
      </ResponseParameters>
    </Step>

    <Step id="3">
      <Command>Media210.GetVideoEncoderConfigurationOptions</Command>
      <Response>Normal</Response>
      <RequestParameters>
        <ConfigurationToken>VEC1</ConfigurationToken>
        <ProfileToken>media_profile1</ProfileToken>
      </RequestParameters>
      <ResponseParameters>
        <ArrayOfVideoEncoder2ConfigurationOptions>
          <VideoEncoder2ConfigurationOptions GovLengthRange="10 20" FrameRatesSupported="30" ProfilesSupported="Simple" ConstantBitRateSupported="true" xmlns:tt="http://www.onvif.org/ver10/schema">
            <tt:Encoding>H265</tt:Encoding>
            <tt:QualityRange>
              <tt:Min>0</tt:Min>
              <tt:Max>100</tt:Max>
            </tt:QualityRange>
            <tt:ResolutionsAvailable>
              <tt:Width>40</tt:Width>
              <tt:Height>80</tt:Height>
            </tt:ResolutionsAvailable>
            <tt:BitrateRange>
              <tt:Min>0</tt:Min>
              <tt:Max>100</tt:Max>
            </tt:BitrateRange>

          </VideoEncoder2ConfigurationOptions>
          <VideoEncoder2ConfigurationOptions  xmlns:tt="http://www.onvif.org/ver10/schema">
            <tt:Encoding>H264</tt:Encoding>
            <tt:QualityRange>
              <tt:Min>0</tt:Min>
              <tt:Max>100</tt:Max>
            </tt:QualityRange>
            <tt:ResolutionsAvailable>
              <tt:Width>40</tt:Width>
              <tt:Height>80</tt:Height>
            </tt:ResolutionsAvailable>
            <tt:BitrateRange>
              <tt:Min>0</tt:Min>
              <tt:Max>100</tt:Max>
            </tt:BitrateRange>

          </VideoEncoder2ConfigurationOptions>
        </ArrayOfVideoEncoder2ConfigurationOptions>
      </ResponseParameters>
    </Step>

<!-- start -->
	
    <Step id="4">
      <Command>Media210.SetVideoEncoderConfiguration</Command>
      <Response>Normal</Response>
      <RequestParameters>
        <VideoEncoder2Configuration token="VEC1">
          <Name>VideoEncConf1</Name>
          <UseCount>1</UseCount>
          <Encoding>H264</Encoding>
          <Resolution>
            <Width>40</Width>
            <Height>80</Height>
          </Resolution>

<!--           <RateControl>
            <FrameRateLimit>0</FrameRateLimit>
            <BitrateLimit>0</BitrateLimit>
          </RateControl> -->

           <Multicast>
                  <Address>
                    <Type>IPv4</Type>
                    <IPv4Address>0.0.0.0</IPv4Address>
                  </Address>
                  <Port>0</Port>
                  <TTL>3</TTL>
                  <AutoStart>False</AutoStart>
            </Multicast>
          <Quality>0</Quality>
          <!--You may enter ANY elements at this point-->
        </VideoEncoder2Configuration>
      </RequestParameters>
      <ResponseParameters>
      </ResponseParameters>
    </Step>
	
    <Step id="5">
      <Command>Media210.GetStreamUri</Command>
      <Response>Normal</Response>
      <RequestParameters>
        <Protocol>RtspUnicast</Protocol>
        <!--see tr2:TransportProtocol-->
        <ProfileToken>media_profile1</ProfileToken>
      </RequestParameters>
      <ResponseParameters>
        <string>rtsp://192.168.10.230/rtsp_tunnel?h26x=4&amp;line=1&amp;inst=1&amp;enableaudio=1&amp;audio_mode=1</string>
      </ResponseParameters>
    </Step>
	
	<!-- restore -->
	
    <Step id="6">
      <Command>Media210.SetVideoEncoderConfiguration</Command>
      <Response>Normal</Response>
      <RequestParameters>
        <VideoEncoder2Configuration token="VEC1">
          <Name>VideoEncConf1</Name>
          <UseCount>1</UseCount>
          <Encoding>H264</Encoding>
          <Resolution>
            <Width>401</Width>
            <Height>801</Height>
          </Resolution>

           <Multicast>
                  <Address>
                    <Type>IPv4</Type>
                    <IPv4Address>0.0.0.0</IPv4Address>
                  </Address>
                  <Port>0</Port>
                  <TTL>3</TTL>
                  <AutoStart>False</AutoStart>
            </Multicast>
          <Quality>7</Quality>
          <!--You may enter ANY elements at this point-->
        </VideoEncoder2Configuration>
      </RequestParameters>
      <ResponseParameters>
      </ResponseParameters>
    </Step>

	</Test>
  <Test ID = "TC.MEDIA2_RTSS-1-1-19.102" ONVIFTestID="MEDIA2_RTSS-1-1-1" Enabled="true">
    <TestName>MEDIA2 STREAMING – H.264 (RTP-Unicast/RTSP/WebSockets)</TestName>
    <Name>Script for Hanwa device</Name>
    <Description>
      GetServicesResponse returns addresses of Hanwa camera
      Script created to check test case with Hanwa device
    </Description>
    <ExpectedResult>
      <ONVIFTestResult>PASSED</ONVIFTestResult>
      <TestSummary>

      </TestSummary>
    </ExpectedResult>
    <Step id="2">
      <Command>Media210.GetServiceCapabilities</Command>
      <Response>Normal</Response>
      <RequestParameters>
      </RequestParameters>
      <ResponseParameters>
        <Capabilities2 SnapshotUri="true" Rotation="true" VideoSourceMode="true" OSD="true" xmlns:tcr="http://www.onvif.org/ver20/media/wsdl">
          <tcr:ProfileCapabilities MaximumNumberOfProfiles="3" ConfigurationsSupported="VideoSource VideoEncoder"></tcr:ProfileCapabilities>
          <tcr:StreamingCapabilities RTSPStreaming="true" RTPMulticast="true" RTP_RTSP_TCP="true" NonAggregateControl="true" RTSPWebSocketUri="ws://112.170.72.113:8081/StreamingServer"></tcr:StreamingCapabilities>
        </Capabilities2>
      </ResponseParameters>
    </Step>
    <!--<Step id="2">
      <Command>Media210.GetServiceCapabilities</Command>
      <Response>Normal</Response>
      <RequestParameters>
      </RequestParameters>
      <ResponseParameters>
        <Capabilities2 SnapshotUri="true" Rotation="true" VideoSourceMode="true" OSD="true" xmlns:tcr="http://www.onvif.org/ver20/media/wsdl">
          <tcr:ProfileCapabilities MaximumNumberOfProfiles="3" ConfigurationsSupported="VideoSource VideoEncoder"></tcr:ProfileCapabilities>
          <tcr:StreamingCapabilities RTSPStreaming="true" RTPMulticast="true" RTP_RTSP_TCP="true" NonAggregateControl="true" RTSPWebSocketUri="ws://websocketstest.com"></tcr:StreamingCapabilities>
        </Capabilities2>
      </ResponseParameters>
    </Step>-->
    <Step id="1">
      <Command>Device10.GetServices</Command>
      <Response>Normal</Response>
      <RequestParameters>
        <IncludeCapability>False</IncludeCapability>
      </RequestParameters>
      <ResponseParameters special="1">
        <ArrayOfService xmlns:tds="http://www.onvif.org/ver10/device/wsdl" xmlns:tt="http://www.onvif.org/ver10/schema">
          <Service>
            <tds:Namespace>http://www.onvif.org/ver10/device/wsdl</tds:Namespace>
            <tds:XAddr>http://112.170.72.113:8081/onvif/device_service</tds:XAddr>
            
            <tds:Version>
              <tt:Major>16</tt:Major>
              <tt:Minor>6</tt:Minor>
            </tds:Version>
          </Service>
          <Service>
            <tds:Namespace>http://www.onvif.org/ver10/media/wsdl</tds:Namespace>
            <tds:XAddr>http://112.170.72.113:8081/onvif/media_service</tds:XAddr>
            
            <tds:Version>
              <tt:Major>2</tt:Major>
              <tt:Minor>60</tt:Minor>
            </tds:Version>
          </Service>
          <Service>
            <tds:Namespace>http://www.onvif.org/ver20/media/wsdl</tds:Namespace>
            <tds:XAddr>http://112.170.72.113:8081/onvif/media_service</tds:XAddr>
            <tds:Capabilities>
              
            </tds:Capabilities>
            <tds:Version>
              <tt:Major>16</tt:Major>
              <tt:Minor>6</tt:Minor>
            </tds:Version>
          </Service>
          <Service>
            <tds:Namespace>http://www.onvif.org/ver10/events/wsdl</tds:Namespace>
            <tds:XAddr>http://112.170.72.113:8081/onvif/event_service</tds:XAddr>
            
            <tds:Version>
              <tt:Major>2</tt:Major>
              <tt:Minor>60</tt:Minor>
            </tds:Version>
          </Service>
          <Service>
            <tds:Namespace>http://www.onvif.org/ver20/imaging/wsdl</tds:Namespace>
            <tds:XAddr>http://112.170.72.113:8081/onvif/imaging_service</tds:XAddr>
            
            <tds:Version>
              <tt:Major>16</tt:Major>
              <tt:Minor>6</tt:Minor>
            </tds:Version>
          </Service>
          <Service>
            <tds:Namespace>http://www.onvif.org/ver20/ptz/wsdl</tds:Namespace>
            <tds:XAddr>http://112.170.72.113:8081/onvif/ptz_service</tds:XAddr>
            
            <tds:Version>
              <tt:Major>16</tt:Major>
              <tt:Minor>6</tt:Minor>
            </tds:Version>
          </Service>
          <Service>
            <tds:Namespace>http://www.onvif.org/ver10/deviceIO/wsdl</tds:Namespace>
            <tds:XAddr>http://112.170.72.113:8081/onvif/deviceio_service</tds:XAddr>
            
            <tds:Version>
              <tt:Major>2</tt:Major>
              <tt:Minor>61</tt:Minor>
            </tds:Version>
          </Service>
          <Service>
            <tds:Namespace>http://www.onvif.org/ver10/recording/wsdl</tds:Namespace>
            <tds:XAddr>http://112.170.72.113:8081/onvif/recording_service</tds:XAddr>
            
            <tds:Version>
              <tt:Major>2</tt:Major>
              <tt:Minor>50</tt:Minor>
            </tds:Version>
          </Service>
          <Service>
            <tds:Namespace>http://www.onvif.org/ver10/search/wsdl</tds:Namespace>
            <tds:XAddr>http://112.170.72.113:8081/onvif/search_service</tds:XAddr>
            
            <tds:Version>
              <tt:Major>2</tt:Major>
              <tt:Minor>42</tt:Minor>
            </tds:Version>
          </Service>
          <Service>
            <tds:Namespace>http://www.onvif.org/ver10/replay/wsdl</tds:Namespace>
            <tds:XAddr>http://112.170.72.113:8081/onvif/replay_service</tds:XAddr>
            
            <tds:Version>
              <tt:Major>2</tt:Major>
              <tt:Minor>21</tt:Minor>
            </tds:Version>
          </Service>
        </ArrayOfService>
      </ResponseParameters>
    </Step>

    <Step id="2">
      <Command>Media210.GetProfiles</Command>
      <Response>Normal</Response>
      <RequestParameters>
        <Type>VideoSource</Type>
        <Type>VideoEncoder</Type>
      </RequestParameters>
      <ResponseParameters>
        <ArrayOfMediaProfile>
          <MediaProfile token="media_profile1">
            <Name xmlns="http://www.onvif.org/ver20/media/wsdl">media2_profile1</Name>
            <Configurations xmlns="http://www.onvif.org/ver20/media/wsdl" xmlns:tt="http://www.onvif.org/ver10/schema">
              <VideoSource token="VSC1">
                <tt:Name>VideoSourceConf1</tt:Name>
                <tt:UseCount>1</tt:UseCount>
                <tt:SourceToken>VS1</tt:SourceToken>
                <tt:Bounds height="1080" width="1920" y="1" x="1">
                </tt:Bounds>
              </VideoSource>
              <VideoEncoder token="VEC1">
                <tt:Name>VideoEncConf1</tt:Name>
                <tt:UseCount>1</tt:UseCount>
                <tt:Encoding>H264</tt:Encoding>
                <tt:Resolution>
                  <tt:Width>401</tt:Width>
                  <tt:Height>801</tt:Height>
                </tt:Resolution>
                <!--<tt:RateControl>
                  <tt:FrameRateLimit>1</tt:FrameRateLimit>
                  -->
                <!--<tt:EncodingInterval>0</tt:EncodingInterval>-->
                <!--
                  <tt:BitrateLimit>2048</tt:BitrateLimit>
                </tt:RateControl>-->
                <!--<tt:H264>
                <tt:GovLength>32</tt:GovLength>
                <tt:H264Profile>Baseline</tt:H264Profile>
              </tt:H264>-->
                <tt:Multicast>
                  <tt:Address>
                    <tt:Type>IPv4</tt:Type>
                    <tt:IPv4Address>0.0.0.0</tt:IPv4Address>
                  </tt:Address>
                  <tt:Port>0</tt:Port>
                  <tt:TTL>3</tt:TTL>
                  <tt:AutoStart>false</tt:AutoStart>
                </tt:Multicast>
                <tt:Quality>7</tt:Quality>
                <tt:SessionTimeout>PT0S</tt:SessionTimeout>
              </VideoEncoder>
            </Configurations>
          </MediaProfile>
        </ArrayOfMediaProfile>
      </ResponseParameters>
    </Step>

    <Step id="3">
      <Command>Media210.GetVideoEncoderConfigurationOptions</Command>
      <Response>Normal</Response>
      <RequestParameters>
        <ConfigurationToken>VEC1</ConfigurationToken>
        <ProfileToken>media_profile1</ProfileToken>
      </RequestParameters>
      <ResponseParameters>
        <ArrayOfVideoEncoder2ConfigurationOptions>
          <VideoEncoder2ConfigurationOptions GovLengthRange="10 20" FrameRatesSupported="30" ProfilesSupported="Simple" ConstantBitRateSupported="true" xmlns:tt="http://www.onvif.org/ver10/schema">
            <tt:Encoding>H265</tt:Encoding>
            <tt:QualityRange>
              <tt:Min>0</tt:Min>
              <tt:Max>100</tt:Max>
            </tt:QualityRange>
            <tt:ResolutionsAvailable>
              <tt:Width>40</tt:Width>
              <tt:Height>80</tt:Height>
            </tt:ResolutionsAvailable>
            <tt:BitrateRange>
              <tt:Min>0</tt:Min>
              <tt:Max>100</tt:Max>
            </tt:BitrateRange>

          </VideoEncoder2ConfigurationOptions>
          <VideoEncoder2ConfigurationOptions  xmlns:tt="http://www.onvif.org/ver10/schema">
            <tt:Encoding>H264</tt:Encoding>
            <tt:QualityRange>
              <tt:Min>0</tt:Min>
              <tt:Max>100</tt:Max>
            </tt:QualityRange>
            <tt:ResolutionsAvailable>
              <tt:Width>40</tt:Width>
              <tt:Height>80</tt:Height>
            </tt:ResolutionsAvailable>
            <tt:BitrateRange>
              <tt:Min>0</tt:Min>
              <tt:Max>100</tt:Max>
            </tt:BitrateRange>

          </VideoEncoder2ConfigurationOptions>
        </ArrayOfVideoEncoder2ConfigurationOptions>
      </ResponseParameters>
    </Step>

    <!-- start -->

    <Step id="4">
      <Command>Media210.SetVideoEncoderConfiguration</Command>
      <Response>Normal</Response>
      <RequestParameters>
        <VideoEncoder2Configuration token="VEC1">
          <Name>VideoEncConf1</Name>
          <UseCount>1</UseCount>
          <Encoding>H264</Encoding>
          <Resolution>
            <Width>40</Width>
            <Height>80</Height>
          </Resolution>

          <!--           <RateControl>
            <FrameRateLimit>0</FrameRateLimit>
            <BitrateLimit>0</BitrateLimit>
          </RateControl> -->

          <Multicast>
            <Address>
              <Type>IPv4</Type>
              <IPv4Address>0.0.0.0</IPv4Address>
            </Address>
            <Port>0</Port>
            <TTL>3</TTL>
            <AutoStart>False</AutoStart>
          </Multicast>
          <Quality>0</Quality>
          <!--You may enter ANY elements at this point-->
        </VideoEncoder2Configuration>
      </RequestParameters>
      <ResponseParameters>
      </ResponseParameters>
    </Step>

    <Step id="5">
      <Command>Media210.GetStreamUri</Command>
      <Response>Normal</Response>
      <RequestParameters>
        <Protocol>RtspUnicast</Protocol>
        <!--see tr2:TransportProtocol-->
        <ProfileToken>media_profile1</ProfileToken>
      </RequestParameters>
      <ResponseParameters>
        <string>rtsp://112.170.72.113:554/onvif/profile2/media.smp</string>
      </ResponseParameters>
    </Step>

    <!-- restore -->

    <Step id="6">
      <Command>Media210.SetVideoEncoderConfiguration</Command>
      <Response>Normal</Response>
      <RequestParameters>
        <VideoEncoder2Configuration token="VEC1">
          <Name>VideoEncConf1</Name>
          <UseCount>1</UseCount>
          <Encoding>H264</Encoding>
          <Resolution>
            <Width>401</Width>
            <Height>801</Height>
          </Resolution>

          <Multicast>
            <Address>
              <Type>IPv4</Type>
              <IPv4Address>0.0.0.0</IPv4Address>
            </Address>
            <Port>0</Port>
            <TTL>3</TTL>
            <AutoStart>False</AutoStart>
          </Multicast>
          <Quality>7</Quality>
          <!--You may enter ANY elements at this point-->
        </VideoEncoder2Configuration>
      </RequestParameters>
      <ResponseParameters>
      </ResponseParameters>
    </Step>

  </Test>
  <Test ID = "TC.MEDIA2_RTSS-1-1-19.103" ONVIFTestID="MEDIA2_RTSS-1-1-1" Enabled="true">
    <TestName>MEDIA2 STREAMING – H.264 (RTP-Unicast/RTSP/WebSockets)</TestName>
    <Name>#1595: A.59 absolute path construction of uri</Name>
    <Description>
     Use simulator on iis located on IP differ from IP od the DTT.
    Script to check that DTT will connect to uri and port of DUT simulator. Check this using wireshark.
    
    </Description>
    <ExpectedResult>
      <ONVIFTestResult>PASSED</ONVIFTestResult>
      <TestSummary>

      </TestSummary>
    </ExpectedResult>
    <Step id="2">
      <Command>Media210.GetServiceCapabilities</Command>
      <Response>Normal</Response>
      <RequestParameters>
      </RequestParameters>
      <ResponseParameters>
        <Capabilities2 SnapshotUri="true" Rotation="true" VideoSourceMode="true" OSD="true" xmlns:tcr="http://www.onvif.org/ver20/media/wsdl">
          <tcr:ProfileCapabilities MaximumNumberOfProfiles="3" ConfigurationsSupported="VideoSource VideoEncoder"></tcr:ProfileCapabilities>
          <tcr:StreamingCapabilities RTSPStreaming="true" RTPMulticast="true" RTP_RTSP_TCP="true" NonAggregateControl="true" RTSPWebSocketUri="ws:/ServiceDevice10/DeviceServiceFake.asmx"></tcr:StreamingCapabilities>
        </Capabilities2>
      </ResponseParameters>
    </Step>
    
    <Step id="1">
      <Command>Device10.GetServices</Command>
      <Response>Normal</Response>
      <RequestParameters>
        <IncludeCapability>False</IncludeCapability>
      </RequestParameters>
      <ResponseParameters special="1">
        <ArrayOfService xmlns:tds="http://www.onvif.org/ver10/device/wsdl" xmlns:tt="http://www.onvif.org/ver10/schema">
          <Service>
            <tds:Namespace>http://www.onvif.org/ver10/device/wsdl</tds:Namespace>
            <tds:XAddr>http://localhost/onvif/ServiceDevice10/DeviceServiceFake.asmx </tds:XAddr>
            <tds:Version>
              <tt:Major>2</tt:Major>
              <tt:Minor>1</tt:Minor>
            </tds:Version>
          </Service>
          <Service>
            <tds:Namespace>http://www.onvif.org/ver10/events/wsdl</tds:Namespace>
            <tds:XAddr>http://localhost/onvif/ServiceEvents10/EventService.asmx</tds:XAddr>
            <tds:Version>
              <tt:Major>2</tt:Major>
              <tt:Minor>1</tt:Minor>
            </tds:Version>
          </Service>
          <Service>
            <tds:Namespace>http://www.onvif.org/ver20/media/wsdl</tds:Namespace>
            <tds:XAddr>http://localhost/onvif/ServiceMedia20/Media2Service.asmx</tds:XAddr>
            <tds:Version>
              <tt:Major>2</tt:Major>
              <tt:Minor>1</tt:Minor>
            </tds:Version>
          </Service>
        </ArrayOfService>
      </ResponseParameters>
    </Step>

    <Step id="2">
      <Command>Media210.GetProfiles</Command>
      <Response>Normal</Response>
      <RequestParameters>
        <Type>VideoSource</Type>
        <Type>VideoEncoder</Type>
      </RequestParameters>
      <ResponseParameters>
        <ArrayOfMediaProfile>
          <MediaProfile token="media_profile1">
            <Name xmlns="http://www.onvif.org/ver20/media/wsdl">media2_profile1</Name>
            <Configurations xmlns="http://www.onvif.org/ver20/media/wsdl" xmlns:tt="http://www.onvif.org/ver10/schema">
              <VideoSource token="VSC1">
                <tt:Name>VideoSourceConf1</tt:Name>
                <tt:UseCount>1</tt:UseCount>
                <tt:SourceToken>VS1</tt:SourceToken>
                <tt:Bounds height="1080" width="1920" y="1" x="1">
                </tt:Bounds>
              </VideoSource>
              <VideoEncoder token="VEC1">
                <tt:Name>VideoEncConf1</tt:Name>
                <tt:UseCount>1</tt:UseCount>
                <tt:Encoding>H264</tt:Encoding>
                <tt:Resolution>
                  <tt:Width>401</tt:Width>
                  <tt:Height>801</tt:Height>
                </tt:Resolution>
                <!--<tt:RateControl>
                  <tt:FrameRateLimit>1</tt:FrameRateLimit>
                  -->
                <!--<tt:EncodingInterval>0</tt:EncodingInterval>-->
                <!--
                  <tt:BitrateLimit>2048</tt:BitrateLimit>
                </tt:RateControl>-->
                <!--<tt:H264>
                <tt:GovLength>32</tt:GovLength>
                <tt:H264Profile>Baseline</tt:H264Profile>
              </tt:H264>-->
                <tt:Multicast>
                  <tt:Address>
                    <tt:Type>IPv4</tt:Type>
                    <tt:IPv4Address>0.0.0.0</tt:IPv4Address>
                  </tt:Address>
                  <tt:Port>0</tt:Port>
                  <tt:TTL>3</tt:TTL>
                  <tt:AutoStart>false</tt:AutoStart>
                </tt:Multicast>
                <tt:Quality>7</tt:Quality>
                <tt:SessionTimeout>PT0S</tt:SessionTimeout>
              </VideoEncoder>
            </Configurations>
          </MediaProfile>
        </ArrayOfMediaProfile>
      </ResponseParameters>
    </Step>

    <Step id="3">
      <Command>Media210.GetVideoEncoderConfigurationOptions</Command>
      <Response>Normal</Response>
      <RequestParameters>
        <ConfigurationToken>VEC1</ConfigurationToken>
        <ProfileToken>media_profile1</ProfileToken>
      </RequestParameters>
      <ResponseParameters>
        <ArrayOfVideoEncoder2ConfigurationOptions>
          <VideoEncoder2ConfigurationOptions GovLengthRange="10 20" FrameRatesSupported="30" ProfilesSupported="Simple" ConstantBitRateSupported="true" xmlns:tt="http://www.onvif.org/ver10/schema">
            <tt:Encoding>H265</tt:Encoding>
            <tt:QualityRange>
              <tt:Min>0</tt:Min>
              <tt:Max>100</tt:Max>
            </tt:QualityRange>
            <tt:ResolutionsAvailable>
              <tt:Width>40</tt:Width>
              <tt:Height>80</tt:Height>
            </tt:ResolutionsAvailable>
            <tt:BitrateRange>
              <tt:Min>0</tt:Min>
              <tt:Max>100</tt:Max>
            </tt:BitrateRange>

          </VideoEncoder2ConfigurationOptions>
          <VideoEncoder2ConfigurationOptions  xmlns:tt="http://www.onvif.org/ver10/schema">
            <tt:Encoding>H264</tt:Encoding>
            <tt:QualityRange>
              <tt:Min>0</tt:Min>
              <tt:Max>100</tt:Max>
            </tt:QualityRange>
            <tt:ResolutionsAvailable>
              <tt:Width>40</tt:Width>
              <tt:Height>80</tt:Height>
            </tt:ResolutionsAvailable>
            <tt:BitrateRange>
              <tt:Min>0</tt:Min>
              <tt:Max>100</tt:Max>
            </tt:BitrateRange>

          </VideoEncoder2ConfigurationOptions>
        </ArrayOfVideoEncoder2ConfigurationOptions>
      </ResponseParameters>
    </Step>

    <!-- start -->

    <Step id="4">
      <Command>Media210.SetVideoEncoderConfiguration</Command>
      <Response>Normal</Response>
      <RequestParameters>
        <VideoEncoder2Configuration token="VEC1">
          <Name>VideoEncConf1</Name>
          <UseCount>1</UseCount>
          <Encoding>H264</Encoding>
          <Resolution>
            <Width>40</Width>
            <Height>80</Height>
          </Resolution>

          <!--           <RateControl>
            <FrameRateLimit>0</FrameRateLimit>
            <BitrateLimit>0</BitrateLimit>
          </RateControl> -->

          <Multicast>
            <Address>
              <Type>IPv4</Type>
              <IPv4Address>0.0.0.0</IPv4Address>
            </Address>
            <Port>0</Port>
            <TTL>3</TTL>
            <AutoStart>False</AutoStart>
          </Multicast>
          <Quality>0</Quality>
          <!--You may enter ANY elements at this point-->
        </VideoEncoder2Configuration>
      </RequestParameters>
      <ResponseParameters>
      </ResponseParameters>
    </Step>

    <Step id="5">
      <Command>Media210.GetStreamUri</Command>
      <Response>Normal</Response>
      <RequestParameters>
        <Protocol>RtspUnicast</Protocol>
        <!--see tr2:TransportProtocol-->
        <ProfileToken>media_profile1</ProfileToken>
      </RequestParameters>
      <ResponseParameters>
        <string>rtsp://192.168.10.129:554/video/test.264</string>
      </ResponseParameters>
    </Step>

    <!-- restore -->

    <Step id="6">
      <Command>Media210.SetVideoEncoderConfiguration</Command>
      <Response>Normal</Response>
      <RequestParameters>
        <VideoEncoder2Configuration token="VEC1">
          <Name>VideoEncConf1</Name>
          <UseCount>1</UseCount>
          <Encoding>H264</Encoding>
          <Resolution>
            <Width>401</Width>
            <Height>801</Height>
          </Resolution>

          <Multicast>
            <Address>
              <Type>IPv4</Type>
              <IPv4Address>0.0.0.0</IPv4Address>
            </Address>
            <Port>0</Port>
            <TTL>3</TTL>
            <AutoStart>False</AutoStart>
          </Multicast>
          <Quality>7</Quality>
          <!--You may enter ANY elements at this point-->
        </VideoEncoder2Configuration>
      </RequestParameters>
      <ResponseParameters>
      </ResponseParameters>
    </Step>

  </Test>
  
	
<!-- negative	 -->
  <Test ID = "TC.MEDIA2_RTSS-1-1-19.201" ONVIFTestID="MEDIA2_RTSS-1-1-1" Enabled="true">
    <TestName>MEDIA2 STREAMING – H.264 (RTP-Unicast/RTSP/WebSockets)</TestName>
    <Name>Incorrect websocket address (http) in capabailities</Name>
    <Description>
    </Description>
    <ExpectedResult>
      <ONVIFTestResult>PASSED</ONVIFTestResult>
      <TestSummary>

      </TestSummary>
    </ExpectedResult>
    <Step id="2">
      <Command>Media210.GetServiceCapabilities</Command>
      <Response>Normal</Response>
      <RequestParameters>
      </RequestParameters>
      <ResponseParameters>
        <Capabilities2 SnapshotUri="true" Rotation="true" VideoSourceMode="true" OSD="true" xmlns:tcr="http://www.onvif.org/ver20/media/wsdl">
          <tcr:ProfileCapabilities MaximumNumberOfProfiles="3" ConfigurationsSupported="VideoSource VideoEncoder"></tcr:ProfileCapabilities>
          <tcr:StreamingCapabilities RTSPStreaming="true" RTPMulticast="true" RTP_RTSP_TCP="true" NonAggregateControl="true" RTSPWebSocketUri="http://192.168.10.192/webSocketServer"></tcr:StreamingCapabilities>
        </Capabilities2>
      </ResponseParameters>
    </Step>
    <Step id="1">
      <Command>Device10.GetServices</Command>
      <Response>Normal</Response>
      <RequestParameters>
        <IncludeCapability>False</IncludeCapability>
      </RequestParameters>
      <ResponseParameters special="1">
        <ArrayOfService xmlns:tds="http://www.onvif.org/ver10/device/wsdl" xmlns:tt="http://www.onvif.org/ver10/schema">
          <Service>
            <tds:Namespace>http://www.onvif.org/ver10/device/wsdl</tds:Namespace>
            <tds:XAddr>http://localhost/onvif/ServiceDevice10/DeviceServiceFake.asmx </tds:XAddr>
            <tds:Version>
              <tt:Major>2</tt:Major>
              <tt:Minor>1</tt:Minor>
            </tds:Version>
          </Service>
          <Service>
            <tds:Namespace>http://www.onvif.org/ver10/events/wsdl</tds:Namespace>
            <tds:XAddr>http://localhost/onvif/ServiceEvents10/EventService.asmx</tds:XAddr>
            <tds:Version>
              <tt:Major>2</tt:Major>
              <tt:Minor>1</tt:Minor>
            </tds:Version>
          </Service>
          <Service>
            <tds:Namespace>http://www.onvif.org/ver20/media/wsdl</tds:Namespace>
            <tds:XAddr>http://localhost/onvif/ServiceMedia20/Media2Service.asmx</tds:XAddr>
            <tds:Version>
              <tt:Major>2</tt:Major>
              <tt:Minor>1</tt:Minor>
            </tds:Version>
          </Service>
        </ArrayOfService>
      </ResponseParameters>
    </Step>

    <Step id="2">
      <Command>Media210.GetProfiles</Command>
      <Response>Normal</Response>
      <RequestParameters>
        <Type>VideoSource</Type>
        <Type>VideoEncoder</Type>
      </RequestParameters>
      <ResponseParameters>
        <ArrayOfMediaProfile>
          <MediaProfile token="media_profile1">
            <Name xmlns="http://www.onvif.org/ver20/media/wsdl">media2_profile1</Name>
            <Configurations xmlns="http://www.onvif.org/ver20/media/wsdl" xmlns:tt="http://www.onvif.org/ver10/schema">
              <VideoSource token="VSC1">
                <tt:Name>VideoSourceConf1</tt:Name>
                <tt:UseCount>1</tt:UseCount>
                <tt:SourceToken>VS1</tt:SourceToken>
                <tt:Bounds height="1080" width="1920" y="1" x="1">
                </tt:Bounds>
              </VideoSource>
              <VideoEncoder token="VEC1">
                <tt:Name>VideoEncConf1</tt:Name>
                <tt:UseCount>1</tt:UseCount>
                <tt:Encoding>H264</tt:Encoding>
                <tt:Resolution>
                  <tt:Width>401</tt:Width>
                  <tt:Height>801</tt:Height>
                </tt:Resolution>
                <!--<tt:RateControl>
                  <tt:FrameRateLimit>1</tt:FrameRateLimit>
                  -->
                <!--<tt:EncodingInterval>0</tt:EncodingInterval>-->
                <!--
                  <tt:BitrateLimit>2048</tt:BitrateLimit>
                </tt:RateControl>-->
                <!--<tt:H264>
                <tt:GovLength>32</tt:GovLength>
                <tt:H264Profile>Baseline</tt:H264Profile>
              </tt:H264>-->
                <tt:Multicast>
                  <tt:Address>
                    <tt:Type>IPv4</tt:Type>
                    <tt:IPv4Address>0.0.0.0</tt:IPv4Address>
                  </tt:Address>
                  <tt:Port>0</tt:Port>
                  <tt:TTL>3</tt:TTL>
                  <tt:AutoStart>false</tt:AutoStart>
                </tt:Multicast>
                <tt:Quality>7</tt:Quality>
                <tt:SessionTimeout>PT0S</tt:SessionTimeout>
              </VideoEncoder>
            </Configurations>
          </MediaProfile>
        </ArrayOfMediaProfile>
      </ResponseParameters>
    </Step>

    <Step id="3">
      <Command>Media210.GetVideoEncoderConfigurationOptions</Command>
      <Response>Normal</Response>
      <RequestParameters>
        <ConfigurationToken>VEC1</ConfigurationToken>
        <ProfileToken>media_profile1</ProfileToken>
      </RequestParameters>
      <ResponseParameters>
        <ArrayOfVideoEncoder2ConfigurationOptions>
          <VideoEncoder2ConfigurationOptions GovLengthRange="10 20" FrameRatesSupported="30" ProfilesSupported="Simple" ConstantBitRateSupported="true" xmlns:tt="http://www.onvif.org/ver10/schema">
            <tt:Encoding>H265</tt:Encoding>
            <tt:QualityRange>
              <tt:Min>0</tt:Min>
              <tt:Max>100</tt:Max>
            </tt:QualityRange>
            <tt:ResolutionsAvailable>
              <tt:Width>40</tt:Width>
              <tt:Height>80</tt:Height>
            </tt:ResolutionsAvailable>
            <tt:BitrateRange>
              <tt:Min>0</tt:Min>
              <tt:Max>100</tt:Max>
            </tt:BitrateRange>

          </VideoEncoder2ConfigurationOptions>
          <VideoEncoder2ConfigurationOptions  xmlns:tt="http://www.onvif.org/ver10/schema">
            <tt:Encoding>H264</tt:Encoding>
            <tt:QualityRange>
              <tt:Min>0</tt:Min>
              <tt:Max>100</tt:Max>
            </tt:QualityRange>
            <tt:ResolutionsAvailable>
              <tt:Width>40</tt:Width>
              <tt:Height>80</tt:Height>
            </tt:ResolutionsAvailable>
            <tt:BitrateRange>
              <tt:Min>0</tt:Min>
              <tt:Max>100</tt:Max>
            </tt:BitrateRange>

          </VideoEncoder2ConfigurationOptions>
        </ArrayOfVideoEncoder2ConfigurationOptions>
      </ResponseParameters>
    </Step>

    <!-- start -->

    <Step id="4">
      <Command>Media210.SetVideoEncoderConfiguration</Command>
      <Response>Normal</Response>
      <RequestParameters>
        <VideoEncoder2Configuration token="VEC1">
          <Name>VideoEncConf1</Name>
          <UseCount>1</UseCount>
          <Encoding>H264</Encoding>
          <Resolution>
            <Width>40</Width>
            <Height>80</Height>
          </Resolution>

          <!--           <RateControl>
            <FrameRateLimit>0</FrameRateLimit>
            <BitrateLimit>0</BitrateLimit>
          </RateControl> -->

          <Multicast>
            <Address>
              <Type>IPv4</Type>
              <IPv4Address>0.0.0.0</IPv4Address>
            </Address>
            <Port>0</Port>
            <TTL>3</TTL>
            <AutoStart>False</AutoStart>
          </Multicast>
          <Quality>0</Quality>
          <!--You may enter ANY elements at this point-->
        </VideoEncoder2Configuration>
      </RequestParameters>
      <ResponseParameters>
      </ResponseParameters>
    </Step>

    <Step id="5">
      <Command>Media210.GetStreamUri</Command>
      <Response>Normal</Response>
      <RequestParameters>
        <Protocol>RtspUnicast</Protocol>
        <!--see tr2:TransportProtocol-->
        <ProfileToken>media_profile1</ProfileToken>
      </RequestParameters>
      <ResponseParameters>
        <string>rtsp://192.168.10.230/rtsp_tunnel?h26x=4&amp;line=1&amp;inst=1&amp;enableaudio=1&amp;audio_mode=1</string>
      </ResponseParameters>
    </Step>

    <!-- restore -->

    <Step id="6">
      <Command>Media210.SetVideoEncoderConfiguration</Command>
      <Response>Normal</Response>
      <RequestParameters>
        <VideoEncoder2Configuration token="VEC1">
          <Name>VideoEncConf1</Name>
          <UseCount>1</UseCount>
          <Encoding>H264</Encoding>
          <Resolution>
            <Width>401</Width>
            <Height>801</Height>
          </Resolution>

          <Multicast>
            <Address>
              <Type>IPv4</Type>
              <IPv4Address>0.0.0.0</IPv4Address>
            </Address>
            <Port>0</Port>
            <TTL>3</TTL>
            <AutoStart>False</AutoStart>
          </Multicast>
          <Quality>7</Quality>
          <!--You may enter ANY elements at this point-->
        </VideoEncoder2Configuration>
      </RequestParameters>
      <ResponseParameters>
      </ResponseParameters>
    </Step>

  </Test>
  <Test ID = "TC.MEDIA2_RTSS-1-1-19.202" ONVIFTestID="MEDIA2_RTSS-1-1-1" Enabled="true">
    <TestName>MEDIA2 STREAMING – H.264 (RTP-Unicast/RTSP/WebSockets)</TestName>
    <Name>Skipped websocket address in capabailities</Name>
    <Description>
    </Description>
    <ExpectedResult>
      <ONVIFTestResult>PASSED</ONVIFTestResult>
      <TestSummary>

      </TestSummary>
    </ExpectedResult>
    <Step id="2">
      <Command>Media210.GetServiceCapabilities</Command>
      <Response>Normal</Response>
      <RequestParameters>
      </RequestParameters>
      <ResponseParameters>
        <Capabilities2 SnapshotUri="true" Rotation="true" VideoSourceMode="true" OSD="true" xmlns:tcr="http://www.onvif.org/ver20/media/wsdl">
          <tcr:ProfileCapabilities MaximumNumberOfProfiles="3" ConfigurationsSupported="VideoSource VideoEncoder" RTSPWebSocketUri="http://192.168.10.192/webSocketServer"></tcr:ProfileCapabilities>
          <tcr:StreamingCapabilities RTSPStreaming="true" RTPMulticast="true" RTP_RTSP_TCP="true" NonAggregateControl="true"></tcr:StreamingCapabilities>
        </Capabilities2>
      </ResponseParameters>
    </Step>
    <Step id="1">
      <Command>Device10.GetServices</Command>
      <Response>Normal</Response>
      <RequestParameters>
        <IncludeCapability>False</IncludeCapability>
      </RequestParameters>
      <ResponseParameters special="1">
        <ArrayOfService xmlns:tds="http://www.onvif.org/ver10/device/wsdl" xmlns:tt="http://www.onvif.org/ver10/schema">
          <Service>
            <tds:Namespace>http://www.onvif.org/ver10/device/wsdl</tds:Namespace>
            <tds:XAddr>http://localhost/onvif/ServiceDevice10/DeviceServiceFake.asmx </tds:XAddr>
            <tds:Version>
              <tt:Major>2</tt:Major>
              <tt:Minor>1</tt:Minor>
            </tds:Version>
          </Service>
          <Service>
            <tds:Namespace>http://www.onvif.org/ver10/events/wsdl</tds:Namespace>
            <tds:XAddr>http://localhost/onvif/ServiceEvents10/EventService.asmx</tds:XAddr>
            <tds:Version>
              <tt:Major>2</tt:Major>
              <tt:Minor>1</tt:Minor>
            </tds:Version>
          </Service>
          <Service>
            <tds:Namespace>http://www.onvif.org/ver20/media/wsdl</tds:Namespace>
            <tds:XAddr>http://localhost/onvif/ServiceMedia20/Media2Service.asmx</tds:XAddr>
            <tds:Version>
              <tt:Major>2</tt:Major>
              <tt:Minor>1</tt:Minor>
            </tds:Version>
          </Service>
        </ArrayOfService>
      </ResponseParameters>
    </Step>

    <Step id="2">
      <Command>Media210.GetProfiles</Command>
      <Response>Normal</Response>
      <RequestParameters>
        <Type>VideoSource</Type>
        <Type>VideoEncoder</Type>
      </RequestParameters>
      <ResponseParameters>
        <ArrayOfMediaProfile>
          <MediaProfile token="media_profile1">
            <Name xmlns="http://www.onvif.org/ver20/media/wsdl">media2_profile1</Name>
            <Configurations xmlns="http://www.onvif.org/ver20/media/wsdl" xmlns:tt="http://www.onvif.org/ver10/schema">
              <VideoSource token="VSC1">
                <tt:Name>VideoSourceConf1</tt:Name>
                <tt:UseCount>1</tt:UseCount>
                <tt:SourceToken>VS1</tt:SourceToken>
                <tt:Bounds height="1080" width="1920" y="1" x="1">
                </tt:Bounds>
              </VideoSource>
              <VideoEncoder token="VEC1">
                <tt:Name>VideoEncConf1</tt:Name>
                <tt:UseCount>1</tt:UseCount>
                <tt:Encoding>H264</tt:Encoding>
                <tt:Resolution>
                  <tt:Width>401</tt:Width>
                  <tt:Height>801</tt:Height>
                </tt:Resolution>
                <!--<tt:RateControl>
                  <tt:FrameRateLimit>1</tt:FrameRateLimit>
                  -->
                <!--<tt:EncodingInterval>0</tt:EncodingInterval>-->
                <!--
                  <tt:BitrateLimit>2048</tt:BitrateLimit>
                </tt:RateControl>-->
                <!--<tt:H264>
                <tt:GovLength>32</tt:GovLength>
                <tt:H264Profile>Baseline</tt:H264Profile>
              </tt:H264>-->
                <tt:Multicast>
                  <tt:Address>
                    <tt:Type>IPv4</tt:Type>
                    <tt:IPv4Address>0.0.0.0</tt:IPv4Address>
                  </tt:Address>
                  <tt:Port>0</tt:Port>
                  <tt:TTL>3</tt:TTL>
                  <tt:AutoStart>false</tt:AutoStart>
                </tt:Multicast>
                <tt:Quality>7</tt:Quality>
                <tt:SessionTimeout>PT0S</tt:SessionTimeout>
              </VideoEncoder>
            </Configurations>
          </MediaProfile>
        </ArrayOfMediaProfile>
      </ResponseParameters>
    </Step>

    <Step id="3">
      <Command>Media210.GetVideoEncoderConfigurationOptions</Command>
      <Response>Normal</Response>
      <RequestParameters>
        <ConfigurationToken>VEC1</ConfigurationToken>
        <ProfileToken>media_profile1</ProfileToken>
      </RequestParameters>
      <ResponseParameters>
        <ArrayOfVideoEncoder2ConfigurationOptions>
          <VideoEncoder2ConfigurationOptions GovLengthRange="10 20" FrameRatesSupported="30" ProfilesSupported="Simple" ConstantBitRateSupported="true" xmlns:tt="http://www.onvif.org/ver10/schema">
            <tt:Encoding>H265</tt:Encoding>
            <tt:QualityRange>
              <tt:Min>0</tt:Min>
              <tt:Max>100</tt:Max>
            </tt:QualityRange>
            <tt:ResolutionsAvailable>
              <tt:Width>40</tt:Width>
              <tt:Height>80</tt:Height>
            </tt:ResolutionsAvailable>
            <tt:BitrateRange>
              <tt:Min>0</tt:Min>
              <tt:Max>100</tt:Max>
            </tt:BitrateRange>

          </VideoEncoder2ConfigurationOptions>
          <VideoEncoder2ConfigurationOptions  xmlns:tt="http://www.onvif.org/ver10/schema">
            <tt:Encoding>H264</tt:Encoding>
            <tt:QualityRange>
              <tt:Min>0</tt:Min>
              <tt:Max>100</tt:Max>
            </tt:QualityRange>
            <tt:ResolutionsAvailable>
              <tt:Width>40</tt:Width>
              <tt:Height>80</tt:Height>
            </tt:ResolutionsAvailable>
            <tt:BitrateRange>
              <tt:Min>0</tt:Min>
              <tt:Max>100</tt:Max>
            </tt:BitrateRange>

          </VideoEncoder2ConfigurationOptions>
        </ArrayOfVideoEncoder2ConfigurationOptions>
      </ResponseParameters>
    </Step>

    <!-- start -->

    <Step id="4">
      <Command>Media210.SetVideoEncoderConfiguration</Command>
      <Response>Normal</Response>
      <RequestParameters>
        <VideoEncoder2Configuration token="VEC1">
          <Name>VideoEncConf1</Name>
          <UseCount>1</UseCount>
          <Encoding>H264</Encoding>
          <Resolution>
            <Width>40</Width>
            <Height>80</Height>
          </Resolution>

          <!--           <RateControl>
            <FrameRateLimit>0</FrameRateLimit>
            <BitrateLimit>0</BitrateLimit>
          </RateControl> -->

          <Multicast>
            <Address>
              <Type>IPv4</Type>
              <IPv4Address>0.0.0.0</IPv4Address>
            </Address>
            <Port>0</Port>
            <TTL>3</TTL>
            <AutoStart>False</AutoStart>
          </Multicast>
          <Quality>0</Quality>
          <!--You may enter ANY elements at this point-->
        </VideoEncoder2Configuration>
      </RequestParameters>
      <ResponseParameters>
      </ResponseParameters>
    </Step>

    <Step id="5">
      <Command>Media210.GetStreamUri</Command>
      <Response>Normal</Response>
      <RequestParameters>
        <Protocol>RtspUnicast</Protocol>
        <!--see tr2:TransportProtocol-->
        <ProfileToken>media_profile1</ProfileToken>
      </RequestParameters>
      <ResponseParameters>
        <string>rtsp://192.168.10.230/rtsp_tunnel?h26x=4&amp;line=1&amp;inst=1&amp;enableaudio=1&amp;audio_mode=1</string>
      </ResponseParameters>
    </Step>

    <!-- restore -->

    <Step id="6">
      <Command>Media210.SetVideoEncoderConfiguration</Command>
      <Response>Normal</Response>
      <RequestParameters>
        <VideoEncoder2Configuration token="VEC1">
          <Name>VideoEncConf1</Name>
          <UseCount>1</UseCount>
          <Encoding>H264</Encoding>
          <Resolution>
            <Width>401</Width>
            <Height>801</Height>
          </Resolution>

          <Multicast>
            <Address>
              <Type>IPv4</Type>
              <IPv4Address>0.0.0.0</IPv4Address>
            </Address>
            <Port>0</Port>
            <TTL>3</TTL>
            <AutoStart>False</AutoStart>
          </Multicast>
          <Quality>7</Quality>
          <!--You may enter ANY elements at this point-->
        </VideoEncoder2Configuration>
      </RequestParameters>
      <ResponseParameters>
      </ResponseParameters>
    </Step>

  </Test>
  <!-- tickets	 -->
<Test ID = "TC.MEDIA2_RTSS-1-1-19.501" ONVIFTestID="MEDIA2_RTSS-1-1-1" Enabled="true">
    <TestName>MEDIA2 STREAMING – H.264 (RTP-Unicast/RTSP/WebSockets)</TestName>
    <Name>Internal error (Dalmaier)</Name>
    <Description>
      
    </Description>
    <ExpectedResult>
      <ONVIFTestResult>PASSED</ONVIFTestResult>
      <TestSummary>

      </TestSummary>
    </ExpectedResult>
    <Step id="2">
      <Command>Media210.GetServiceCapabilities</Command>
      <Response>Normal</Response>
      <RequestParameters>
      </RequestParameters>
      <ResponseParameters>
        <Capabilities2 SnapshotUri="true" Rotation="false" VideoSourceMode="false" OSD="false" TemporaryOSDText="false" Mask="false" SourceMask="false" xmlns:tcr="http://www.onvif.org/ver20/media/wsdl">
          <tcr:ProfileCapabilities MaximumNumberOfProfiles="10" ConfigurationsSupported="VideoSource VideoEncoder Metadata PTZ"></tcr:ProfileCapabilities>
          <tcr:StreamingCapabilities RTSPStreaming="true" RTPMulticast="true" RTP_RTSP_TCP="true" NonAggregateControl="false" RTSPWebSocketUri="" AutoStartMulticast="false"></tcr:StreamingCapabilities>
        </Capabilities2>
      </ResponseParameters>
    </Step>
    
    <Step id="1">
      <Command>Device10.GetServices</Command>
      <Response>Normal</Response>
      <RequestParameters>
        <IncludeCapability>False</IncludeCapability>
      </RequestParameters>
      <ResponseParameters special="1">
        <ArrayOfService xmlns:tds="http://www.onvif.org/ver10/device/wsdl" xmlns:tt="http://www.onvif.org/ver10/schema">
          <Service>
            <tds:Namespace>http://www.onvif.org/ver10/device/wsdl</tds:Namespace>
            <tds:XAddr>http://localhost/onvif/ServiceDevice10/DeviceServiceFake.asmx </tds:XAddr>
            <tds:Version>
              <tt:Major>2</tt:Major>
              <tt:Minor>1</tt:Minor>
            </tds:Version>
          </Service>
          <Service>
            <tds:Namespace>http://www.onvif.org/ver10/events/wsdl</tds:Namespace>
            <tds:XAddr>http://localhost/onvif/ServiceEvents10/EventService.asmx</tds:XAddr>
            <tds:Version>
              <tt:Major>2</tt:Major>
              <tt:Minor>1</tt:Minor>
            </tds:Version>
          </Service>
          <Service>
            <tds:Namespace>http://www.onvif.org/ver20/media/wsdl</tds:Namespace>
            <tds:XAddr>http://localhost/onvif/ServiceMedia20/Media2Service.asmx</tds:XAddr>
            <tds:Version>
              <tt:Major>2</tt:Major>
              <tt:Minor>1</tt:Minor>
            </tds:Version>
          </Service>
        </ArrayOfService>
      </ResponseParameters>
    </Step>

    <Step id="2">
      <Command>Media210.GetProfiles</Command>
      <Response>Normal</Response>
      <RequestParameters>
	    <Type>VideoSource</Type>
        <Type>VideoEncoder</Type>
      </RequestParameters>
      <ResponseParameters>
        <ArrayOfMediaProfile>
          <MediaProfile token="18467">
            <Name xmlns="http://www.onvif.org/ver20/media/wsdl">new profile2</Name>
            <Configurations xmlns="http://www.onvif.org/ver20/media/wsdl" xmlns:tt="http://www.onvif.org/ver10/schema">
              <VideoSource token="3">
            <tt:Name>Test Location: Live+Playback</tt:Name>
            <tt:UseCount>1</tt:UseCount>
            <tt:SourceToken>2</tt:SourceToken>
            <tt:Bounds x="0" y="0" width="1920" height="1080" />
          </VideoSource>
          <VideoEncoder token="1" GovLength="240" Profile="new profile2">
            <tt:Name>TestName2</tt:Name>
            <tt:UseCount>1</tt:UseCount>
            <tt:Encoding>MPEG4</tt:Encoding>
            <tt:Resolution>
              <tt:Width>2592</tt:Width>
              <tt:Height>1920</tt:Height>
            </tt:Resolution>
            <tt:RateControl ConstantBitRate="true">
              <tt:FrameRateLimit>60</tt:FrameRateLimit>
              <tt:BitrateLimit>32000</tt:BitrateLimit>
            </tt:RateControl>
            <tt:Multicast>
              <tt:Address>
                <tt:Type>IPv4</tt:Type>
                <tt:IPv4Address>239.0.0.1</tt:IPv4Address>
              </tt:Address>
              <tt:Port>9100</tt:Port>
              <tt:TTL>1</tt:TTL>
              <tt:AutoStart>false</tt:AutoStart>
            </tt:Multicast>
            <tt:Quality>100</tt:Quality>
          </VideoEncoder>
              
            </Configurations>
          </MediaProfile>
        <MediaProfile token="41">
            <Name xmlns="http://www.onvif.org/ver20/media/wsdl">new profile</Name>
            <Configurations xmlns="http://www.onvif.org/ver20/media/wsdl" xmlns:tt="http://www.onvif.org/ver10/schema">
              <VideoSource token="2">
            <tt:Name>Test Location: Live+Playback</tt:Name>
            <tt:UseCount>1</tt:UseCount>
            <tt:SourceToken>1</tt:SourceToken>
            <tt:Bounds x="0" y="0" width="1920" height="1080" />
          </VideoSource>
          <VideoEncoder token="10" Profile="new profile">
            <tt:Name>
            </tt:Name>
            <tt:UseCount>1</tt:UseCount>
            <tt:Encoding>H264</tt:Encoding>
            <tt:Resolution>
              <tt:Width>640</tt:Width>
              <tt:Height>480</tt:Height>
            </tt:Resolution>
            <tt:Multicast>
              <tt:Address>
                <tt:Type>IPv4</tt:Type>
                <tt:IPv4Address>239.0.0.1</tt:IPv4Address>
              </tt:Address>
              <tt:Port>9102</tt:Port>
              <tt:TTL>1</tt:TTL>
              <tt:AutoStart>false</tt:AutoStart>
            </tt:Multicast>
            <tt:Quality>80</tt:Quality>
          </VideoEncoder>
              
            </Configurations>
          </MediaProfile>
        <MediaProfile token="6334">
            <Name xmlns="http://www.onvif.org/ver20/media/wsdl">new profile</Name>
            <Configurations xmlns="http://www.onvif.org/ver20/media/wsdl" xmlns:tt="http://www.onvif.org/ver10/schema">
              
          <VideoSource token="4">
            <tt:Name>Test Location: Live+Playback</tt:Name>
            <tt:UseCount>1</tt:UseCount>
            <tt:SourceToken>3</tt:SourceToken>
            <tt:Bounds x="0" y="0" width="1920" height="1080" />
          </VideoSource>
          <VideoEncoder token="9" Profile="new profile3">
            <tt:Name>
            </tt:Name>
            <tt:UseCount>1</tt:UseCount>
            <tt:Encoding>H264</tt:Encoding>
            <tt:Resolution>
              <tt:Width>640</tt:Width>
              <tt:Height>480</tt:Height>
            </tt:Resolution>
            <tt:Multicast>
              <tt:Address>
                <tt:Type>IPv4</tt:Type>
                <tt:IPv4Address>239.0.0.1</tt:IPv4Address>
              </tt:Address>
              <tt:Port>9116</tt:Port>
              <tt:TTL>1</tt:TTL>
              <tt:AutoStart>false</tt:AutoStart>
            </tt:Multicast>
            <tt:Quality>80</tt:Quality>
          </VideoEncoder>
              
            </Configurations>
          </MediaProfile>
        </ArrayOfMediaProfile>
      </ResponseParameters>
    </Step>

    <Step id="3">
      <Command>Media210.GetVideoEncoderConfigurationOptions</Command>
      <Response>Normal</Response>
      <RequestParameters>
        <ConfigurationToken>1</ConfigurationToken>
        <ProfileToken>18467</ProfileToken>
      </RequestParameters>
      <ResponseParameters>
        <ArrayOfVideoEncoder2ConfigurationOptions>
          <VideoEncoder2ConfigurationOptions GovLengthRange="1 240" FrameRatesSupported="60 1" ProfilesSupported="Baseline Main" ConstantBitRateSupported="true" xmlns:tt="http://www.onvif.org/ver10/schema">
              <tt:Encoding>H264</tt:Encoding>
        <tt:QualityRange>
          <tt:Min>0</tt:Min>
          <tt:Max>100</tt:Max>
        </tt:QualityRange>
        <tt:ResolutionsAvailable>
          <tt:Width>320</tt:Width>
          <tt:Height>240</tt:Height>
        </tt:ResolutionsAvailable>
        <tt:ResolutionsAvailable>
          <tt:Width>640</tt:Width>
          <tt:Height>480</tt:Height>
        </tt:ResolutionsAvailable>
        <tt:ResolutionsAvailable>
          <tt:Width>1280</tt:Width>
          <tt:Height>720</tt:Height>
        </tt:ResolutionsAvailable>
        <tt:ResolutionsAvailable>
          <tt:Width>1920</tt:Width>
          <tt:Height>1080</tt:Height>
        </tt:ResolutionsAvailable>
        <tt:ResolutionsAvailable>
          <tt:Width>2048</tt:Width>
          <tt:Height>1536</tt:Height>
        </tt:ResolutionsAvailable>
        <tt:ResolutionsAvailable>
          <tt:Width>2336</tt:Width>
          <tt:Height>1744</tt:Height>
        </tt:ResolutionsAvailable>
        <tt:ResolutionsAvailable>
          <tt:Width>2592</tt:Width>
          <tt:Height>1920</tt:Height>
        </tt:ResolutionsAvailable>
        <tt:BitrateRange>
          <tt:Min>10</tt:Min>
          <tt:Max>32000</tt:Max>
        </tt:BitrateRange>

          </VideoEncoder2ConfigurationOptions>
        <VideoEncoder2ConfigurationOptions GovLengthRange="1 240" FrameRatesSupported="60 1" ProfilesSupported="SP ASP" ConstantBitRateSupported="true" xmlns:tt="http://www.onvif.org/ver10/schema">
              <tt:Encoding>MPEG4</tt:Encoding>
        <tt:QualityRange>
          <tt:Min>0</tt:Min>
          <tt:Max>100</tt:Max>
        </tt:QualityRange>
        <tt:ResolutionsAvailable>
          <tt:Width>320</tt:Width>
          <tt:Height>240</tt:Height>
        </tt:ResolutionsAvailable>
        <tt:ResolutionsAvailable>
          <tt:Width>640</tt:Width>
          <tt:Height>480</tt:Height>
        </tt:ResolutionsAvailable>
        <tt:ResolutionsAvailable>
          <tt:Width>1280</tt:Width>
          <tt:Height>720</tt:Height>
        </tt:ResolutionsAvailable>
        <tt:ResolutionsAvailable>
          <tt:Width>1920</tt:Width>
          <tt:Height>1080</tt:Height>
        </tt:ResolutionsAvailable>
        <tt:ResolutionsAvailable>
          <tt:Width>2048</tt:Width>
          <tt:Height>1536</tt:Height>
        </tt:ResolutionsAvailable>
        <tt:ResolutionsAvailable>
          <tt:Width>2336</tt:Width>
          <tt:Height>1744</tt:Height>
        </tt:ResolutionsAvailable>
        <tt:ResolutionsAvailable>
          <tt:Width>2592</tt:Width>
          <tt:Height>1920</tt:Height>
        </tt:ResolutionsAvailable>
        <tt:BitrateRange>
          <tt:Min>10</tt:Min>
          <tt:Max>32000</tt:Max>
        </tt:BitrateRange>

          </VideoEncoder2ConfigurationOptions>
        <VideoEncoder2ConfigurationOptions FrameRatesSupported="60 1" ConstantBitRateSupported="true" xmlns:tt="http://www.onvif.org/ver10/schema">
             <tt:Encoding>JPEG</tt:Encoding>
        <tt:QualityRange>
          <tt:Min>0</tt:Min>
          <tt:Max>100</tt:Max>
        </tt:QualityRange>
        <tt:ResolutionsAvailable>
          <tt:Width>320</tt:Width>
          <tt:Height>240</tt:Height>
        </tt:ResolutionsAvailable>
        <tt:ResolutionsAvailable>
          <tt:Width>640</tt:Width>
          <tt:Height>480</tt:Height>
        </tt:ResolutionsAvailable>
        <tt:ResolutionsAvailable>
          <tt:Width>1280</tt:Width>
          <tt:Height>720</tt:Height>
        </tt:ResolutionsAvailable>
        <tt:ResolutionsAvailable>
          <tt:Width>1920</tt:Width>
          <tt:Height>1080</tt:Height>
        </tt:ResolutionsAvailable>
        <tt:ResolutionsAvailable>
          <tt:Width>2048</tt:Width>
          <tt:Height>1536</tt:Height>
        </tt:ResolutionsAvailable>
        <tt:ResolutionsAvailable>
          <tt:Width>2336</tt:Width>
          <tt:Height>1744</tt:Height>
        </tt:ResolutionsAvailable>
        <tt:ResolutionsAvailable>
          <tt:Width>2592</tt:Width>
          <tt:Height>1920</tt:Height>
        </tt:ResolutionsAvailable>
        <tt:BitrateRange>
          <tt:Min>10</tt:Min>
          <tt:Max>32000</tt:Max>
        </tt:BitrateRange>

          </VideoEncoder2ConfigurationOptions>
        </ArrayOfVideoEncoder2ConfigurationOptions>
      </ResponseParameters>
    </Step>

<!-- start -->
	
    <Step id="4">
      <Command>Media210.SetVideoEncoderConfiguration</Command>
      <Response>Normal</Response>
      <RequestParameters>
        <VideoEncoder2Configuration token="VEC1">
          <Name>VideoEncConf1</Name>
          <UseCount>1</UseCount>
          <Encoding>H264</Encoding>
          <Resolution>
            <Width>40</Width>
            <Height>80</Height>
          </Resolution>

<!--           <RateControl>
            <FrameRateLimit>0</FrameRateLimit>
            <BitrateLimit>0</BitrateLimit>
          </RateControl> -->

           <Multicast>
                  <Address>
                    <Type>IPv4</Type>
                    <IPv4Address>0.0.0.0</IPv4Address>
                  </Address>
                  <Port>0</Port>
                  <TTL>3</TTL>
                  <AutoStart>False</AutoStart>
            </Multicast>
          <Quality>0</Quality>
          <!--You may enter ANY elements at this point-->
        </VideoEncoder2Configuration>
      </RequestParameters>
      <ResponseParameters>
      </ResponseParameters>
    </Step>
	
    <Step id="5">
      <Command>Media210.GetStreamUri</Command>
      <Response>Normal</Response>
      <RequestParameters>
        <Protocol>RtspUnicast</Protocol>
        <!--see tr2:TransportProtocol-->
        <ProfileToken>media_profile1</ProfileToken>
      </RequestParameters>
      <ResponseParameters>
        <string>rtsp://192.168.10.230/rtsp_tunnel?h26x=4&amp;line=1&amp;inst=1&amp;enableaudio=1&amp;audio_mode=1</string>
      </ResponseParameters>
    </Step>
	
	<!-- restore -->
	
    <Step id="6">
      <Command>Media210.SetVideoEncoderConfiguration</Command>
      <Response>Normal</Response>
      <RequestParameters>
        <VideoEncoder2Configuration token="VEC1">
          <Name>VideoEncConf1</Name>
          <UseCount>1</UseCount>
          <Encoding>H264</Encoding>
          <Resolution>
            <Width>401</Width>
            <Height>801</Height>
          </Resolution>

           <Multicast>
                  <Address>
                    <Type>IPv4</Type>
                    <IPv4Address>0.0.0.0</IPv4Address>
                  </Address>
                  <Port>0</Port>
                  <TTL>3</TTL>
                  <AutoStart>False</AutoStart>
            </Multicast>
          <Quality>7</Quality>
          <!--You may enter ANY elements at this point-->
        </VideoEncoder2Configuration>
      </RequestParameters>
      <ResponseParameters>
      </ResponseParameters>
    </Step>
  
<Step id="2">
      <Command>Media210.GetProfiles</Command>
      <Response>Normal</Response>
      <RequestParameters>
	    <Type>VideoSource</Type>
        <Type>VideoEncoder</Type>
      </RequestParameters>
      <ResponseParameters>
        <ArrayOfMediaProfile>
          <MediaProfile token="18467">
            <Name xmlns="http://www.onvif.org/ver20/media/wsdl">new profile2</Name>
            <Configurations xmlns="http://www.onvif.org/ver20/media/wsdl" xmlns:tt="http://www.onvif.org/ver10/schema">
              <VideoSource token="3">
            <tt:Name>Test Location: Live+Playback</tt:Name>
            <tt:UseCount>1</tt:UseCount>
            <tt:SourceToken>2</tt:SourceToken>
            <tt:Bounds x="0" y="0" width="1920" height="1080" />
          </VideoSource>
          <VideoEncoder token="1" GovLength="240" Profile="new profile2">
            <tt:Name>TestName2</tt:Name>
            <tt:UseCount>1</tt:UseCount>
            <tt:Encoding>MPEG4</tt:Encoding>
            <tt:Resolution>
              <tt:Width>2592</tt:Width>
              <tt:Height>1920</tt:Height>
            </tt:Resolution>
            <tt:RateControl ConstantBitRate="true">
              <tt:FrameRateLimit>60</tt:FrameRateLimit>
              <tt:BitrateLimit>32000</tt:BitrateLimit>
            </tt:RateControl>
            <tt:Multicast>
              <tt:Address>
                <tt:Type>IPv4</tt:Type>
                <tt:IPv4Address>239.0.0.1</tt:IPv4Address>
              </tt:Address>
              <tt:Port>9100</tt:Port>
              <tt:TTL>1</tt:TTL>
              <tt:AutoStart>false</tt:AutoStart>
            </tt:Multicast>
            <tt:Quality>100</tt:Quality>
          </VideoEncoder>
              
            </Configurations>
          </MediaProfile>
        
        
        </ArrayOfMediaProfile>
      </ResponseParameters>
    </Step>

	</Test>
	
	</TestSuit>
